<%- include("partials/header", { title: "Engi-Log | Ana Sayfa" }) %>

<main class="container">

    <!-- HERO SECTION -->
    <section class="hero">
        <h1 class="text-gradient">HatalarÄ± Ã‡Ã¶zÃ¼me,
Deneyimi Mirasa DÃ¶nÃ¼ÅŸtÃ¼rÃ¼n</h1>

        <p class="hero-lead">
            Teknik sorunlar iÃ§in merkezi Ã§Ã¶zÃ¼m platformu. HatalarÄ±n nedenlerini, uygulanmÄ±ÅŸ Ã§Ã¶zÃ¼mlerini ve doÄŸrulama bilgilerini tek yerde bulun.
        </p>

        <!-- ZiyaretÃ§i Ä°statistikleri -->
        <div class="hero-stats">
            <span class="font-mono">ğŸ‘¥ Toplam ZiyaretÃ§i: <strong class="stat-count" id="toplamZiyaretci"><%= typeof ziyaretciSayisi !== 'undefined' ? ziyaretciSayisi : '0' %></strong></span>
            <span class="font-mono">ğŸŸ¢ Åu an <strong class="stat-count" id="onlineKullanici">0</strong> kiÅŸi aktif</span>
        </div>

        <div class="hero-actions">
            <a href="/sorunlar/ekle" class="btn btn-primary">
                <span class="font-mono" style="font-size: 1.05rem;">+</span>
                Sorun Bildir
            </a>

            <a href="/sorunlar" class="btn btn-outline">
                KeÅŸfetmeye BaÅŸla
            </a>
        </div>
    </section>

    <!-- PLATFORM FEATURES -->
    <section class="features" aria-labelledby="features-title">
        <h2 id="features-title">Platform Ne Sunar?</h2>

        <div class="features-grid">
            <article class="card feature-card">
                <h3>Sorun PaylaÅŸÄ±mÄ±</h3>
                <p>KÄ±sa, odaklÄ± raporlarla hatalarÄ± kaydedin. Repro adÄ±mlarÄ±nÄ±, ortam bilgilerini ve beklenen davranÄ±ÅŸÄ± paylaÅŸÄ±n.</p>
            </article>

            <article class="card feature-card">
                <h3>Uzman OnaylÄ± Ã‡Ã¶zÃ¼mler</h3>
                <p>Ã‡Ã¶zÃ¼mler uzmanlar tarafÄ±ndan deÄŸerlendirilebilir; hangi adÄ±mlar iÅŸe yaradÄ±, hangileri riskli notlanÄ±r.</p>
            </article>

            <article class="card feature-card">
                <h3>Teknik ArÅŸiv</h3>
                <p>Benzer vakalar arÅŸivlenir, tekrar eden hatalar ve kÃ¶k neden analizleri kolayca eriÅŸilebilir olur.</p>
            </article>

            <article class="card feature-card">
                <h3>Topluluk Destekli Bilgi</h3>
                <p>Yorumlar, tartÄ±ÅŸmalar ve doÄŸrulamalarla Ã§Ã¶zÃ¼m Ã¶nerileri gÃ¼Ã§lenir; kolektif bilgi gÃ¼venilirleÅŸir.</p>
            </article>
        </div>
    </section>

    <!-- HOW IT WORKS -->
    <section class="how" aria-labelledby="how-title">
        <h2 id="how-title">NasÄ±l Ã‡alÄ±ÅŸÄ±r?</h2>

        <div class="how-grid">
            <div class="step">
                <div class="step-index">1</div>
                <h4>Sorunu ekle</h4>
                <p>AdÄ±mlarÄ±, loglarÄ± ve beklenen davranÄ±ÅŸÄ± ekleyin â€” kÄ±sa ve teknik.</p>
            </div>

            <div class="step">
                <div class="step-index">2</div>
                <h4>Ã‡Ã¶zÃ¼mleri incele</h4>
                <p>Benzer vakalar, Ã¶nerilen dÃ¼zeltmeler ve tartÄ±ÅŸma geÃ§miÅŸini hÄ±zlÄ±ca gÃ¶zden geÃ§irin.</p>
            </div>

            <div class="step">
                <div class="step-index">3</div>
                <h4>DoÄŸrulanmÄ±ÅŸ bilgiyi uygula</h4>
                <p>Test edilmiÅŸ Ã§Ã¶zÃ¼mleri proje ortamÄ±nÄ±za uygulayÄ±n ve sonuÃ§larÄ± paylaÅŸÄ±n.</p>
            </div>
        </div>
    </section>

    <!-- RECENT ITEMS -->
    <section class="recent" aria-labelledby="recent-title">
        <h2 id="recent-title">En Son Eklenenler</h2>

        <div class="recent-grid">
            <% if (typeof sonSorunlar !== 'undefined' && sonSorunlar.length) { %>
                <% sonSorunlar.slice(0,4).forEach(function(s) { %>
                    <a class="card recent-card" href="/sorunlar/<%= s._id %>">
                        <h4><%= s.title || 'BaÅŸlÄ±k yok' %></h4>
                        <p class="text-muted"><%= (s.category || 'Genel') + ' Â· ' + (new Date(s.createdAt).toLocaleDateString()) %></p>
                    </a>
                <% }) %>
            <% } else { %>
                <a class="card recent-card" href="/sorunlar">KÄ±sa baÄŸlantÄ±: Yeni raporlar iÃ§in sayfayÄ± ziyaret edin</a>
                <a class="card recent-card" href="/duyurular">Duyurular: Sistem gÃ¼ncellemelerini kontrol edin</a>
                <a class="card recent-card" href="/sorunlar/ekle">Bir sorun raporu oluÅŸturun</a>
            <% } %>
        </div>
    </section>

    <!-- BOTTOM SPACER BEFORE FOOTER -->
    <div class="page-spacer" aria-hidden="true"></div>

</main>

<!-- ============================================ -->
<!-- SOCKET.IO CLIENT - ONLINE KULLANICI SAYISI -->
<!-- ============================================ -->
<script src="/socket.io/socket.io.js"></script>
<script>
    /**
     * Socket.IO BaÄŸlantÄ±sÄ±
     * 
     * Bu script, anlÄ±k online kullanÄ±cÄ± sayÄ±sÄ±nÄ± gÃ¶sterir.
     * - Sayfa aÃ§Ä±lÄ±nca Socket.IO baÄŸlantÄ±sÄ± kurulur
     * - Sunucudan online kullanÄ±cÄ± sayÄ±sÄ± alÄ±nÄ±r
     * - KullanÄ±cÄ± sayÄ±sÄ± deÄŸiÅŸtiÄŸinde otomatik gÃ¼ncellenir
     * - Sayfa kapanÄ±nca baÄŸlantÄ± kopar
     */
    
    // Socket.IO baÄŸlantÄ±sÄ±nÄ± kur
    const socket = io();
    
    // Online kullanÄ±cÄ± sayÄ±sÄ±nÄ± gÃ¶steren element
    const onlineKullaniciElement = document.getElementById('onlineKullanici');
    
    // ============================================
    // BAÄLANTI KURULDU: Ä°LK SAYIYI AL
    // ============================================
    socket.on('connect', () => {
        console.log('[Socket.IO] BaÄŸlantÄ± kuruldu');
    });
    
    // ============================================
    // ONLINE KULLANICI SAYISI GÃœNCELLEMESÄ°
    // ============================================
    // Sunucudan online kullanÄ±cÄ± sayÄ±sÄ± geldiÄŸinde
    socket.on('onlineCount', (count) => {
        onlineKullaniciElement.textContent = count;
        console.log(`[Socket.IO] Online kullanÄ±cÄ± sayÄ±sÄ±: ${count}`);
    });
    
    // Online kullanÄ±cÄ± sayÄ±sÄ± gÃ¼ncellendiÄŸinde (baÅŸka kullanÄ±cÄ±lar girdi/Ã§Ä±ktÄ±)
    socket.on('onlineCountUpdate', (count) => {
        onlineKullaniciElement.textContent = count;
        console.log(`[Socket.IO] Online kullanÄ±cÄ± sayÄ±sÄ± gÃ¼ncellendi: ${count}`);
    });
    
    // ============================================
    // HEARTBEAT: SUNUCUYA HALA AKTÄ°F OLDUÄUMUZU BÄ°LDÄ°R
    // ============================================
    // Sunucu ping gÃ¶nderdiÄŸinde pong ile yanÄ±t ver
    socket.on('ping', () => {
        socket.emit('pong');
    });
    
    // ============================================
    // BAÄLANTI KOPTU
    // ============================================
    socket.on('disconnect', () => {
        console.log('[Socket.IO] BaÄŸlantÄ± koptu');
        onlineKullaniciElement.textContent = '0';
    });
    
    // ============================================
    // SAYFA KAPANIRKEN: BAÄLANTIYI KES
    // ============================================
    // Sayfa kapanÄ±rken veya yenilenirken baÄŸlantÄ±yÄ± kes
    window.addEventListener('beforeunload', () => {
        socket.disconnect();
    });
</script>

<%- include("partials/footer") %>
